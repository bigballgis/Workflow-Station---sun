<mxfile host="app.diagrams.net" modified="2026-01-25T00:00:00.000Z" agent="Adam" version="22.1.16" etag="generated" type="device">
  <diagram name="API Gateway Flow" id="api-gateway-sequence">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="850" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title" value="API Gateway Flow - SSO to S2B Token Exchange" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="300" y="20" width="500" height="30" as="geometry" />
        </mxCell>
        
        <!-- Upstream Client Actor -->
        <mxCell id="client" value="Upstream Client" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="80" y="100" width="40" height="80" as="geometry" />
        </mxCell>
        
        <!-- Client Lifeline -->
        <mxCell id="client-lifeline" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="client">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="100" y="180" as="sourcePoint" />
            <mxPoint x="100" y="650" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- API Gateway -->
        <mxCell id="gateway" value="API Gateway&lt;br&gt;(Middle Platform)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="240" y="100" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Gateway Lifeline -->
        <mxCell id="gateway-lifeline" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="300" y="160" as="sourcePoint" />
            <mxPoint x="300" y="650" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- SSO Service -->
        <mxCell id="sso" value="SSO Service&lt;br&gt;(Token Exchange)&lt;br&gt;S2B" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="480" y="100" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- SSO Lifeline -->
        <mxCell id="sso-lifeline" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="540" y="160" as="sourcePoint" />
            <mxPoint x="540" y="650" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Template API -->
        <mxCell id="template" value="Template API&lt;br&gt;(Prompt Template Service)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="720" y="100" width="140" height="60" as="geometry" />
        </mxCell>
        
        <!-- Template Lifeline -->
        <mxCell id="template-lifeline" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="790" y="160" as="sourcePoint" />
            <mxPoint x="790" y="650" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Step 1: Client to Gateway -->
        <mxCell id="step1" value="1. POST /list&lt;br&gt;(with SSO token in body)" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#1976D2;fontSize=11;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="100" y="220" as="sourcePoint" />
            <mxPoint x="300" y="220" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Gateway Activation Box 1 -->
        <mxCell id="gateway-active1" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="295" y="220" width="10" height="340" as="geometry" />
        </mxCell>
        
        <!-- Step 2: Gateway to SSO -->
        <mxCell id="step2" value="2. Exchange SSO Token&lt;br&gt;(Request S2B JWT)" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#F57C00;fontSize=11;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="305" y="280" as="sourcePoint" />
            <mxPoint x="540" y="280" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- SSO Activation Box -->
        <mxCell id="sso-active" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="535" y="280" width="10" height="60" as="geometry" />
        </mxCell>
        
        <!-- Step 3: SSO to Gateway -->
        <mxCell id="step3" value="3. Return JWT Token&lt;br&gt;(S2B Token)" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#F57C00;dashed=1;dashPattern=8 8;fontSize=11;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="540" y="340" as="sourcePoint" />
            <mxPoint x="305" y="340" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Step 4: Gateway to Template API -->
        <mxCell id="step4" value="4. GET /prompt-templates&lt;br&gt;(with S2B JWT Token)" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#388E3C;fontSize=11;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="305" y="400" as="sourcePoint" />
            <mxPoint x="790" y="400" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Template Activation Box -->
        <mxCell id="template-active" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="785" y="400" width="10" height="60" as="geometry" />
        </mxCell>
        
        <!-- Step 5: Template API to Gateway -->
        <mxCell id="step5" value="5. Return Template List&lt;br&gt;(Prompt Template Data)" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#388E3C;dashed=1;dashPattern=8 8;fontSize=11;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="790" y="460" as="sourcePoint" />
            <mxPoint x="305" y="460" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Step 6: Gateway to Client -->
        <mxCell id="step6" value="6. Response&lt;br&gt;(Template List Data)" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#1976D2;dashed=1;dashPattern=8 8;fontSize=11;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="300" y="520" as="sourcePoint" />
            <mxPoint x="100" y="520" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Summary Box -->
        <mxCell id="summary-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;opacity=60;" vertex="1" parent="1">
          <mxGeometry x="40" y="680" width="820" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="summary-text" value="&lt;b&gt;Flow Summary:&lt;/b&gt;&lt;br&gt;1. Upstream client clicks &quot;list&quot; button, sends request with SSO token&lt;br&gt;2. API Gateway exchanges SSO token for S2B JWT token&lt;br&gt;3. API Gateway uses S2B token to fetch prompt templates&lt;br&gt;4. Template list returned to upstream client&lt;br&gt;&lt;br&gt;&lt;b&gt;Key:&lt;/b&gt; Blue = Client-Gateway | Orange = Token Exchange | Green = Template Retrieval&lt;br&gt;Solid lines = Request | Dashed lines = Response" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="60" y="690" width="780" height="120" as="geometry" />
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>