# æ‰€æœ‰è¡¨ä¸»é”®æ£€æŸ¥æŠ¥å‘Š

## ğŸ“Š ç»Ÿè®¡ç»“æœ

### workflow_platform_executable_clean_fixed.sql

- **æ€»è¡¨æ•°**: 141 ä¸ª
- **æœ‰ä¸»é”®**: 30 ä¸ªï¼ˆä»… sys_* è¡¨ï¼‰
- **æ— ä¸»é”®**: 111 ä¸ª

---

## âœ… æœ‰ä¸»é”®çš„è¡¨ï¼ˆ30 ä¸ªï¼‰

### sys_* è¡¨ï¼ˆ30 ä¸ªï¼‰- å·²ä¿®å¤

æ‰€æœ‰ `sys_*` è¡¨åœ¨æ–‡ä»¶æœ«å°¾é€šè¿‡ `ALTER TABLE` è¯­å¥æ·»åŠ äº†ä¸»é”®ï¼š

1. âœ… sys_approvers
2. âœ… sys_business_unit_roles
3. âœ… sys_business_units
4. âœ… sys_developer_role_permissions
5. âœ… sys_dictionaries
6. âœ… sys_dictionary_data_sources
7. âœ… sys_dictionary_items
8. âœ… sys_dictionary_versions
9. âœ… sys_function_unit_access
10. âœ… sys_function_unit_approvals
11. âœ… sys_function_unit_contents
12. âœ… sys_function_unit_dependencies
13. âœ… sys_function_unit_deployments
14. âœ… sys_function_units
15. âœ… sys_login_audit
16. âœ… sys_member_change_logs
17. âœ… sys_permission_requests
18. âœ… sys_permissions
19. âœ… sys_role_assignments
20. âœ… sys_role_permissions
21. âœ… sys_roles
22. âœ… sys_user_business_unit_roles
23. âœ… sys_user_business_units
24. âœ… sys_user_preferences
25. âœ… sys_user_roles
26. âœ… sys_users
27. âœ… sys_virtual_group_members
28. âœ… sys_virtual_group_roles
29. âœ… sys_virtual_group_task_history
30. âœ… sys_virtual_groups

---

## âŒ ç¼ºå°‘ä¸»é”®çš„è¡¨ï¼ˆ111 ä¸ªï¼‰

### 1. Flowable è¡¨ï¼ˆact_*ï¼‰- 67 ä¸ª

**è¯´æ˜**: Flowable å·¥ä½œæµå¼•æ“çš„è¡¨ï¼Œé€šå¸¸ç”± Flowable è‡ªåŠ¨ç®¡ç†ä¸»é”®

| è¡¨å | ä¸»é”®å­—æ®µ | çŠ¶æ€ |
|------|---------|------|
| act_app_appdef | id_ | âŒ ç¼ºå°‘ |
| act_app_databasechangelog | id | âŒ ç¼ºå°‘ |
| act_app_databasechangeloglock | id | âŒ ç¼ºå°‘ |
| act_app_deployment | id_ | âŒ ç¼ºå°‘ |
| act_app_deployment_resource | id_ | âŒ ç¼ºå°‘ |
| act_cmmn_casedef | id_ | âŒ ç¼ºå°‘ |
| act_cmmn_databasechangelog | id | âŒ ç¼ºå°‘ |
| act_cmmn_databasechangeloglock | id | âŒ ç¼ºå°‘ |
| act_cmmn_deployment | id_ | âŒ ç¼ºå°‘ |
| act_cmmn_deployment_resource | id_ | âŒ ç¼ºå°‘ |
| act_cmmn_hi_case_inst | id_ | âŒ ç¼ºå°‘ |
| act_cmmn_hi_mil_inst | id_ | âŒ ç¼ºå°‘ |
| act_cmmn_hi_plan_item_inst | id_ | âŒ ç¼ºå°‘ |
| act_cmmn_ru_case_inst | id_ | âŒ ç¼ºå°‘ |
| act_cmmn_ru_mil_inst | id_ | âŒ ç¼ºå°‘ |
| act_cmmn_ru_plan_item_inst | id_ | âŒ ç¼ºå°‘ |
| act_cmmn_ru_sentry_part_inst | id_ | âŒ ç¼ºå°‘ |
| act_dmn_databasechangelog | id | âŒ ç¼ºå°‘ |
| act_dmn_databasechangeloglock | id | âŒ ç¼ºå°‘ |
| act_dmn_decision | id_ | âŒ ç¼ºå°‘ |
| act_dmn_deployment | id_ | âŒ ç¼ºå°‘ |
| act_dmn_deployment_resource | id_ | âŒ ç¼ºå°‘ |
| act_dmn_hi_decision_execution | id_ | âŒ ç¼ºå°‘ |
| act_evt_log | log_nr_ | âŒ ç¼ºå°‘ |
| act_ge_bytearray | id_ | âŒ ç¼ºå°‘ |
| act_ge_property | name_ | âŒ ç¼ºå°‘ |
| act_hi_actinst | id_ | âŒ ç¼ºå°‘ |
| act_hi_attachment | id_ | âŒ ç¼ºå°‘ |
| act_hi_comment | id_ | âŒ ç¼ºå°‘ |
| act_hi_detail | id_ | âŒ ç¼ºå°‘ |
| act_hi_entitylink | id_ | âŒ ç¼ºå°‘ |
| act_hi_identitylink | id_ | âŒ ç¼ºå°‘ |
| act_hi_procinst | id_ | âŒ ç¼ºå°‘ |
| act_hi_taskinst | id_ | âŒ ç¼ºå°‘ |
| act_hi_tsk_log | id_ | âŒ ç¼ºå°‘ |
| act_hi_varinst | id_ | âŒ ç¼ºå°‘ |
| act_id_bytearray | id_ | âŒ ç¼ºå°‘ |
| act_id_group | id_ | âŒ ç¼ºå°‘ |
| act_id_info | id_ | âŒ ç¼ºå°‘ |
| act_id_membership | id_ | âŒ ç¼ºå°‘ |
| act_id_priv | id_ | âŒ ç¼ºå°‘ |
| act_id_priv_mapping | id_ | âŒ ç¼ºå°‘ |
| act_id_property | name_ | âŒ ç¼ºå°‘ |
| act_id_token | id_ | âŒ ç¼ºå°‘ |
| act_id_user | id_ | âŒ ç¼ºå°‘ |
| act_procdef_info | id_ | âŒ ç¼ºå°‘ |
| act_re_deployment | id_ | âŒ ç¼ºå°‘ |
| act_re_model | id_ | âŒ ç¼ºå°‘ |
| act_re_procdef | id_ | âŒ ç¼ºå°‘ |
| act_ru_actinst | id_ | âŒ ç¼ºå°‘ |
| act_ru_deadletter_job | id_ | âŒ ç¼ºå°‘ |
| act_ru_entitylink | id_ | âŒ ç¼ºå°‘ |
| act_ru_event_subscr | id_ | âŒ ç¼ºå°‘ |
| act_ru_execution | id_ | âŒ ç¼ºå°‘ |
| act_ru_external_job | id_ | âŒ ç¼ºå°‘ |
| act_ru_history_job | id_ | âŒ ç¼ºå°‘ |
| act_ru_identitylink | id_ | âŒ ç¼ºå°‘ |
| act_ru_job | id_ | âŒ ç¼ºå°‘ |
| act_ru_suspended_job | id_ | âŒ ç¼ºå°‘ |
| act_ru_task | id_ | âŒ ç¼ºå°‘ |
| act_ru_timer_job | id_ | âŒ ç¼ºå°‘ |
| act_ru_variable | id_ | âŒ ç¼ºå°‘ |

**æ³¨æ„**: Flowable è¡¨çš„ä¸»é”®é€šå¸¸ç”± Flowable å¼•æ“åœ¨è¿è¡Œæ—¶è‡ªåŠ¨æ·»åŠ ï¼Œä½† SQL æ–‡ä»¶ä¸­åº”è¯¥åŒ…å«ä¸»é”®å®šä¹‰ã€‚

---

### 2. Flowable Event Registry è¡¨ï¼ˆflw_*ï¼‰- 9 ä¸ª

| è¡¨å | ä¸»é”®å­—æ®µ | çŠ¶æ€ |
|------|---------|------|
| flw_channel_definition | id_ | âŒ ç¼ºå°‘ |
| flw_ev_databasechangelog | id | âŒ ç¼ºå°‘ |
| flw_ev_databasechangeloglock | id | âŒ ç¼ºå°‘ |
| flw_event_definition | id_ | âŒ ç¼ºå°‘ |
| flw_event_deployment | id_ | âŒ ç¼ºå°‘ |
| flw_event_resource | id_ | âŒ ç¼ºå°‘ |
| flw_ru_batch | id_ | âŒ ç¼ºå°‘ |
| flw_ru_batch_part | id_ | âŒ ç¼ºå°‘ |

---

### 3. Developer Workstation è¡¨ï¼ˆdw_*ï¼‰- 11 ä¸ª

| è¡¨å | ä¸»é”®å­—æ®µ | çŠ¶æ€ |
|------|---------|------|
| dw_action_definitions | id | âŒ ç¼ºå°‘ |
| dw_field_definitions | id | âŒ ç¼ºå°‘ |
| dw_foreign_keys | id | âŒ ç¼ºå°‘ |
| dw_form_definitions | id | âŒ ç¼ºå°‘ |
| dw_form_table_bindings | id | âŒ ç¼ºå°‘ |
| dw_function_units | id | âŒ ç¼ºå°‘ |
| dw_icons | id | âŒ ç¼ºå°‘ |
| dw_operation_logs | id | âŒ ç¼ºå°‘ |
| dw_process_definitions | id | âŒ ç¼ºå°‘ |
| dw_table_definitions | id | âŒ ç¼ºå°‘ |
| dw_versions | id | âŒ ç¼ºå°‘ |

**æ³¨æ„**: åœ¨ Flyway è¿ç§»è„šæœ¬ä¸­ï¼Œè¿™äº›è¡¨éƒ½æœ‰ä¸»é”®ï¼ˆ`BIGSERIAL PRIMARY KEY`ï¼‰ï¼Œä½† `workflow_platform_executable_clean_fixed.sql` ä¸­ç¼ºå°‘ã€‚

---

### 4. User Portal è¡¨ï¼ˆup_*ï¼‰- 10 ä¸ª

| è¡¨å | ä¸»é”®å­—æ®µ | çŠ¶æ€ |
|------|---------|------|
| up_dashboard_layout | id | âŒ ç¼ºå°‘ |
| up_delegation_audit | id | âŒ ç¼ºå°‘ |
| up_delegation_rule | id | âŒ ç¼ºå°‘ |
| up_favorite_process | id | âŒ ç¼ºå°‘ |
| up_notification_preference | id | âŒ ç¼ºå°‘ |
| up_permission_request | id | âŒ ç¼ºå°‘ |
| up_process_draft | id | âŒ ç¼ºå°‘ |
| up_process_history | id | âŒ ç¼ºå°‘ |
| up_process_instance | id | âŒ ç¼ºå°‘ |
| up_user_preference | id | âŒ ç¼ºå°‘ |

---

### 5. Workflow è¡¨ï¼ˆwf_*ï¼‰- 6 ä¸ª

| è¡¨å | ä¸»é”®å­—æ®µ | çŠ¶æ€ |
|------|---------|------|
| wf_audit_logs | id | âŒ ç¼ºå°‘ |
| wf_exception_records | id | âŒ ç¼ºå°‘ |
| wf_extended_task_info | id | âŒ ç¼ºå°‘ |
| wf_process_variables | id | âŒ ç¼ºå°‘ |
| wf_saga_steps | id | âŒ ç¼ºå°‘ |
| wf_saga_transactions | id | âŒ ç¼ºå°‘ |

---

### 6. Admin Center è¡¨ï¼ˆadmin_*ï¼‰- 14 ä¸ª

| è¡¨å | ä¸»é”®å­—æ®µ | çŠ¶æ€ |
|------|---------|------|
| admin_alert_rules | id | âŒ ç¼ºå°‘ |
| admin_alerts | id | âŒ ç¼ºå°‘ |
| admin_audit_logs | id | âŒ ç¼ºå°‘ |
| admin_column_permissions | id | âŒ ç¼ºå°‘ |
| admin_config_history | id | âŒ ç¼ºå°‘ |
| admin_data_permission_rules | id | âŒ ç¼ºå°‘ |
| admin_log_retention_policies | id | âŒ ç¼ºå°‘ |
| admin_password_history | id | âŒ ç¼ºå°‘ |
| admin_permission_change_history | id | âŒ ç¼ºå°‘ |
| admin_permission_conflicts | id | âŒ ç¼ºå°‘ |
| admin_permission_delegations | id | âŒ ç¼ºå°‘ |
| admin_security_policies | id | âŒ ç¼ºå°‘ |
| admin_system_configs | id | âŒ ç¼ºå°‘ |
| admin_system_logs | id | âŒ ç¼ºå°‘ |

---

## ğŸ” åˆ†æ

### é—®é¢˜åŸå› 

1. **workflow_platform_executable_clean_fixed.sql** å¯èƒ½æ˜¯ä»ç°æœ‰æ•°æ®åº“å¯¼å‡ºçš„ï¼ˆ`pg_dump`ï¼‰
2. å¯¼å‡ºæ—¶å¯èƒ½ä½¿ç”¨äº† `--no-owner` æˆ–ç±»ä¼¼é€‰é¡¹ï¼Œå¯¼è‡´ä¸»é”®çº¦æŸä¸¢å¤±
3. æˆ–è€…è¡¨æ˜¯é€šè¿‡ Hibernate `ddl-auto: update` åˆ›å»ºçš„ï¼Œæ²¡æœ‰æ˜¾å¼çš„ä¸»é”®å®šä¹‰

### å½±å“

- âŒ **æ•°æ®å®Œæ•´æ€§**: æ²¡æœ‰ä¸»é”®çš„è¡¨æ— æ³•ä¿è¯æ•°æ®å”¯ä¸€æ€§
- âŒ **æ€§èƒ½**: æ²¡æœ‰ä¸»é”®çš„è¡¨æŸ¥è¯¢æ€§èƒ½è¾ƒå·®
- âŒ **å¤–é”®å¼•ç”¨**: å…¶ä»–è¡¨æ— æ³•æ­£ç¡®å¼•ç”¨è¿™äº›è¡¨
- âŒ **ORM æ˜ å°„**: JPA/Hibernate éœ€è¦ä¸»é”®æ‰èƒ½æ­£å¸¸å·¥ä½œ

---

## âœ… ä¿®å¤å»ºè®®

### æ–¹æ¡ˆ 1: åœ¨ CREATE TABLE è¯­å¥ä¸­æ·»åŠ ä¸»é”®ï¼ˆæ¨èï¼‰

ä¿®æ”¹æ¯ä¸ªè¡¨çš„å®šä¹‰ï¼Œåœ¨ `id` å­—æ®µåæ·»åŠ  `PRIMARY KEY`ï¼š

```sql
-- ä¿®å¤å‰
CREATE TABLE IF NOT EXISTS public.dw_function_units (
    id bigint NOT NULL,
    ...
);

-- ä¿®å¤å
CREATE TABLE IF NOT EXISTS public.dw_function_units (
    id bigint PRIMARY KEY,  -- âœ… æ·»åŠ  PRIMARY KEY
    ...
);
```

### æ–¹æ¡ˆ 2: åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ  ALTER TABLE è¯­å¥ï¼ˆå·²ç”¨äº sys_* è¡¨ï¼‰

åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ  `DO` å—ï¼Œä¸ºæ‰€æœ‰è¡¨æ·»åŠ ä¸»é”®ï¼š

```sql
DO $$
BEGIN
    -- dw_* è¡¨
    IF NOT EXISTS (SELECT 1 FROM pg_constraint WHERE conname = 'dw_function_units_pkey') THEN
        ALTER TABLE public.dw_function_units ADD PRIMARY KEY (id);
    END IF;
    -- ... å…¶ä»–è¡¨
END $$;
```

### æ–¹æ¡ˆ 3: ä½¿ç”¨ Flyway è¿ç§»è„šæœ¬ï¼ˆæœ€ä½³å®è·µï¼‰

- âœ… ä½¿ç”¨ Flyway è¿ç§»è„šæœ¬ï¼Œå®ƒä»¬å·²ç»æ­£ç¡®å®šä¹‰äº†ä¸»é”®
- âœ… ä¸è¦ä½¿ç”¨ `workflow_platform_executable_clean_fixed.sql` ä½œä¸ºåˆå§‹åŒ–è„šæœ¬

---

## ğŸ“ ä¼˜å…ˆçº§

### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»ä¿®å¤ï¼‰

- **dw_* è¡¨**ï¼ˆ11 ä¸ªï¼‰- åº”ç”¨æ ¸å¿ƒè¡¨
- **up_* è¡¨**ï¼ˆ10 ä¸ªï¼‰- ç”¨æˆ·é—¨æˆ·è¡¨
- **wf_* è¡¨**ï¼ˆ6 ä¸ªï¼‰- å·¥ä½œæµè¡¨
- **admin_* è¡¨**ï¼ˆ14 ä¸ªï¼‰- ç®¡ç†åå°è¡¨

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆå»ºè®®ä¿®å¤ï¼‰

- **act_* è¡¨**ï¼ˆ67 ä¸ªï¼‰- Flowable è¡¨ï¼ˆå¯èƒ½ç”± Flowable è‡ªåŠ¨ç®¡ç†ï¼‰
- **flw_* è¡¨**ï¼ˆ9 ä¸ªï¼‰- Flowable Event Registry è¡¨

---

## âœ… æ€»ç»“

- **æ€»è¡¨æ•°**: 141 ä¸ª
- **æœ‰ä¸»é”®**: 30 ä¸ªï¼ˆä»… sys_* è¡¨ï¼‰
- **æ— ä¸»é”®**: 111 ä¸ª
- **ä¿®å¤çŠ¶æ€**: ä»… sys_* è¡¨å·²ä¿®å¤

**å»ºè®®**: 
1. ä¼˜å…ˆä¿®å¤åº”ç”¨è¡¨ï¼ˆdw_*, up_*, wf_*, admin_*ï¼‰
2. Flowable è¡¨ï¼ˆact_*, flw_*ï¼‰å¯èƒ½ç”± Flowable å¼•æ“è‡ªåŠ¨ç®¡ç†ï¼Œä½†å»ºè®®ä¹Ÿæ·»åŠ ä¸»é”®å®šä¹‰
3. è€ƒè™‘ä½¿ç”¨ Flyway è¿ç§»è„šæœ¬æ›¿ä»£ `workflow_platform_executable_clean_fixed.sql`
